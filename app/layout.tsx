import type { Metadata } from "next"
import "./globals.css"
import { auth, signOut } from "@/auth"
import Link from "next/link"
import Button from "./components/Button"

export const metadata: Metadata = {
  title: "Create Next App",
  description: "Generated by create next app",
}

export default async function RootLayout({
  children,
}: Readonly<{
  children: React.ReactNode
}>) {
  const session = await auth()
  const userName = session?.user?.name
  const userRole = session?.user?.role

  return (
    <html
      lang="en"
      suppressHydrationWarning>
      <body className="min-h-screen flex flex-col">
        <header className="flex px-6 py-2 font-bold gap-6 text-xl">
          <Link href="/">Home</Link>
          <Link href="/issue-list">Issue List</Link>
        </header>
        {children}
        <footer className="flex flex-grow justify-center items-center gap-4 py-4">
          {session ? `Name: ${userName}, Role: ${userRole}` : null}
          {session ? (
            <form
              action={async () => {
                "use server"
                await signOut()
              }}>
              <Button
                className="border rounded-md py-1 px-2"
                type="submit">
                Sign Out
              </Button>
            </form>
          ) : (
            <Link
              className="border rounded-md py-1 px-2"
              href="/">
              Login
            </Link>
          )}
        </footer>
      </body>
    </html>
  )
}
